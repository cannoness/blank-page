{{- $album := .Parent "view" -}}
{{- $links := .Data "links" -}}
{{- $streamURL := .Data "streamURL" -}}
{{- $description := .Data "summary" -}}
{{- $attachmentID := .Data "attachmentId" -}}
{{- $imageURL := .Data "imageURL" -}}
{{- $iconURL := .IconURL -}}

{{- if eq "" $iconURL -}}
	{{- $iconURL =  $album.IconURL -}}
{{- end -}}

<div id="creation-{{.StreamID}}" class="page padding-none">

	<link rel="stylesheet" href="/{{.ParentID}}/stylesheet">
	
	<meta property="og:image" content="{{.AttributedTo.IconURL}}">
	<meta property="og:site_name" content="{{.DomainLabel}}">
	<meta property="og:description" content="{{.Summary}}">
	<meta property="og:music:musician" content="{{.AttributedTo.ProfileURL}}">

	<div class="md:flex-row margin-bottom" >
		<div style="width:24px;">
					{{- if eq .AttributedTo.IconURL "" -}}
							<div class="circle-64"></div>
						{{- else -}}
							<img src="{{.AttributedTo.IconURL}}" class="circle-64">
					{{- end -}}
				</div>
		<div class="md:width-32"></div>
		<div class="flex-grow-1">
			<div class="text-lg margin-top-none">
				<a href="/@{{$album.AttributedTo.UserID.Hex}}" class="turboclick" aria-label="Artist: $album.AttributedTo.Name">
					{{$album.AttributedTo.Name}}
				</a> 
				<span aria-hidden="true">&middot;</span>
				<a href="/{{$album.StreamID}}" class="turboclick" aria-label="Album: $album.Label">{{ $album.Label }}</a>
			</div>
			<h1 class="margin-vertical-none">
				<span aria-label="Title: {{.Label}}">{{.Label}}</span>
				{{- if eq true (.Data "explicit") -}}
					<span class="text-light-gray text-xl margin-left" title="Explicit" aria-label="Explicit">{{icon "explicit-fill"}}</span>
				{{- end -}}
			</h1>

			<div class="margin-vertical">
					<img src="{{$imageURL}}" alt=""></div>
			<div class="margin-vertical-lg">

				<div id="media-controls" class="margin-vertical-lg">
					<button hx-get="/{{.StreamID}}/prev" role="link" aria-label="Previous">{{icon "caret-left-fill"}} Prev</button>
					<button hx-get="/{{.StreamID}}/next" role="link" aria-label="Next">Next {{icon "caret-right-fill"}}</button>
				</div>
					<a href="{{$links}}" target="_blank" class="block ellipsis">
						<i class="bi bi-link-45deg"></i> Source
					</a><br>
				<div class="text-sm">
					<button hx-get="/{{.StreamID}}/intent?intent=create&content={{.Label}} {{.Permalink}}"><span aria-hidden="true" class="margin-left-xs">{{icon "share"}}</span> Share</button>
					<button hx-get="/{{.StreamID}}/intent?intent=like&object={{.Permalink}}"><span aria-hidden="true" class="margin-left-xs">{{icon "thumbs-up"}}</span> Like</button>
				</div>
	
			</div>

		</div>
	</div>

	<div class="md:flex-row-reverse">

		<div class="flex-grow-1">

			{{- if ne nil $description -}}
				<div class="margin-bottom-xl padding-right-xl">{{$description | text}}</div>
			{{- end -}}
	
		</div>

		<div class="md:width-32 flex-shrink-0 flex-grow-0"></div>
		<div class="md:width-256 flex-shrink-0">


				{{- if .Tags.NotEmpty -}}
					<div id="song-tags" class="text-sm margin-bottom">
						{{- range $index, $tag := .Tags -}}
							{{- if eq "Hashtag" $tag.Type}}
							<a href="/works?q=%23{{$tag.Name}}" hx-boost="true" class="tag margin-bottom-sm">#{{$tag.Name}}</a>
							{{- end -}}
						{{- end -}}
					</div>
				{{- end -}}

				{{- if $links.NotEmpty -}}

					<h3>Stream Online</h3>
					{{- range $key, $value := $links -}}

						{{- if ne "" $value -}}
							{{- $icon := "music-note-beamed" -}}
							{{- $label := $value -}}

							{{- if eq "AMAZON" $key -}}
								{{- $label = "Amazon Music" -}}
								{{- $icon = "amazon" -}}

							{{- else if eq "APPLE" $key -}}
								{{- $icon = "apple" -}}
								{{- $label = "Apple Music" -}}

							{{- else if eq "BANDCAMP" $key -}}
								{{- $label = "Bandcamp" -}}

							{{- else if eq "GOOGLE" $key -}}
								{{- $label = "Google Play" -}}
								{{- $icon = "google" -}}

							{{- else if eq "IHEARTRADIO" $key -}}
								{{- $label = "iHeartRadio" -}}

							{{- else if eq "PANDORA" $key -}}
								{{- $label = "Pandora" -}}

							{{- else if eq "SPOTIFY" $key -}}
								{{- $label = "Spotify" -}}
								{{- $icon = "spotify" -}}

							{{- else if eq "SOUNDCLOUD" $key -}}
								{{- $label = "SoundCloud" -}}
								{{- $icon = "cloud" -}}

							{{- else if eq "TIDAL" $key -}}
								{{- $label = "Tidal" -}}

							{{- else if eq "YOUTUBE" $key -}}
								{{- $label = "YouTube Music" -}}
								{{- $icon = "youtube" -}}

							{{- else -}}
								{{- $label = domainOnly $value -}}

							{{- end -}}

							<a href="{{$value}}" target="_blank">
								<i class="bi bi-{{$icon}}"></i> {{ $label }}
							</a><br>
						{{- end -}}

					{{- end -}}
					<br>
				{{- end -}}

				{{- if ne nil $streamURL -}}
					<a id="work-video" href="{{$streamURL}}" target="_blank" class="block ellipsis">
						<i class="bi bi-camera-video-fill"></i> Music Video
					</a><br>
				{{- end -}}

				<br>
				{{- if ne nil (.Data "artist") -}}
					<span id="work-artist">Artist: {{.Data "artist"}}</span><br>
				{{- end -}}

				{{- if ne nil (.Data "composer") -}}
					<span id="work-composer">Composer: {{.Data "composer"}}</span><br>
				{{- end -}}

				{{- if ne nil (.Data "producer") -}}
					<span id="work-producer">Producer: {{.Data "producer"}}</span><br>
				{{- end -}}

				<br>
				{{- if ne nil (.Data "isrc") -}}
					<span id="work-isrc">ISRC: {{.Data "isrc"}}</span><br>
				{{- end -}}

			</div>

		</div>

		{{- if .UserCan "edit" -}}
			<div class="pos-absolute-top-right text-xs">
				<button hx-get="/{{.StreamID}}/edit">Edit Song</button>
			</div>

			<div hx-ext="sse" sse-connect="/{{.StreamID}}/sse">
				<div
					hx-get="/{{.StreamID}}"
					hx-trigger="sse:{{.StreamID}}, refreshPage from:window"
					hx-target="#main"
					hx-swap="innerHTML"
					hx-push-url="false">
				</div>
			</div>
		{{- end -}}

	</div>

</div>