{{- $streamID := .StreamID -}}
{{- $tags := .Tags -}}
{{- $songs := .Children.Top60.Slice -}}
{{- $canEdit := .UserCan "edit" -}}
{{- $isPlayable := false -}}
{{- $isowner := .IsOwner -}}
{{- $links := .Data "links" -}}

{{- range $index, $song := $songs -}}
	{{- if ne nil $song.Data.imageURL -}}
		{{- $isPlayable = true -}}
	{{- end -}}
{{- end -}}
      <output id="output">
          <p class=".text-info"> -- </p>
      </output>

<div class="page padding-none">

	<link rel="stylesheet" type="text/css" href="/{{.StreamID}}/stylesheet?v={{.ETag}}"/>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta property="og:title" content="{{.Label}}">
	<meta property="og:url" content="{{.Permalink}}">
	<meta property="og:image" content="{{.IconURL}}">
	<meta property="og:description" content="{{.Summary}}">
	<meta property="og:site_name" content="{{.DomainLabel}}">
	<meta property="creation:creator" content="{{.AttributedTo.ProfileURL}}">

	{{- if not .IsPublished -}}
		<div class="clickable alert-red" hx-get="/{{.StreamID}}/publish" role="button">
			{{icon "alert-fill"}}
			This album HAS NOT BEEN published yet and won't be seen by others.
			<span class="text-underline">Click here to publish it</span>
		</div>
	{{- end -}}

	<div class="padding	">

		<!-- First Row: Album Name and Artwork -->
		<div class="md:flex-row margin-bottom margin-top-lg">
			<div class="md:width-128 flex-shrink-0">
				{{- if ne "" .IconURL -}}
					<img src="{{.IconURL}}" class="width-100% aspect-square" aria-hidden="true" style="object-fit:cover;">
				{{- else if $canEdit -}}
					<div class="aspect-square text-center flex-column flex-justify-center flex-align-center" style="border:solid 1px var(--black)" script="install blockselect()">
						<a hx-get="/{{.StreamID}}/edit" class="text-plain">Click here to add album art</a>
					</div>
				{{- end -}}

				{{- if not .IsPublished -}}
					<div class="pos-absolute-four-corners bg-stripes flex-center">
					</div>
				{{- end -}}

				{{- if ne "" .Summary -}}
					<article class="margin-bottom-lg">
						<h3>Album Notes</h3>
						{{.Summary | markdown}}
					</article>
				{{- end -}}
			</div>

			<div class="md:width-32"></div>
			<div class="flex-grow-1">
				<h1 class="margin-top-none">{{.Label}}</h1>
				<div class="text-sm margin-top-none">
					<div class="pos-absolute-top-left text-sm">
						<a hx-get="/@{{.ParentID}}" href="/@{{.ParentID}}" class="turboclick" aria-label="Artist: {{.AttributedTo.Name}}">
							{{.AttributedTo.Name}}
						</a>
					</div>
				</div>

				<div class="margin-vertical"></div>

				{{- if and $songs.IsEmpty $canEdit -}}
					<div class="margin-vertical-lg">
						<button class="primary" hx-get="/{{.StreamID}}/add-creation"><td><span aria-hidden="true">{{icon "plus"}}</span> Add the first creation to this album</button>

						<a href="/{{.Token}}/edit">Upload Photos</a>

						{{- if .UserCan "properties" -}}
							<a hx-get="/{{.Token}}/properties">Edit Info</a>
						{{- end -}}

						{{- if .UserCan "sharing" -}}
							<a hx-get="/{{.Token}}/sharing">Sharing</a>
						{{- end -}}

						<div class="right">
						{{- if .UserCan "delete" -}}
							<a hx-get="/{{.Token}}/delete" class="text-red">Delete</a>
						{{- end -}}
						</div>
					</div>

				{{- end -}}

			</div>
		</div>

		<!-- Second Row: -->
		<div class="md:flex-row-reverse">
			<!-- Image Cards -->

			<div id="container-all" class="container-all">
				{{- .View "children" -}}
			</div>

			<div class="md:width-8 flex-shrink-1 flex-grow-0"></div>
			<div class="md:width-128 flex-shrink-1">
			<div class="text-sm">
				{{- range $index, $tag := $tags -}}
					{{- if eq "Hashtag" $tag.Type}}
						<a xhref="/albums?q=%23{{$tag.Name}}" class="tag margin-bottom-sm">#{{$tag.Name}}</a>
					{{- end -}}
				{{- end -}}
			</div>

			{{- if $links.NotEmpty -}}
				<div class="margin-bottom-lg">
					<h3>Source Links</h3>
					{{- range $key, $value := $links -}}

						{{- if ne "" $value -}}
							{{- $icon := "music-note-beamed" -}}
							{{- $label := $value -}}

							{{- if eq "AMAZON" $key -}}
								{{- $label = "Amazon Music" -}}
								{{- $icon = "amazon" -}}

							{{- else if eq "APPLE" $key -}}
								{{- $icon = "apple" -}}
								{{- $label = "Apple Music" -}}

							{{- else if eq "BANDCAMP" $key -}}
								{{- $label = "Bandcamp" -}}

							{{- else if eq "GOOGLE" $key -}}
								{{- $label = "Google Play" -}}
								{{- $icon = "google" -}}

							{{- else if eq "IHEARTRADIO" $key -}}
								{{- $label = "iHeartRadio" -}}

							{{- else if eq "PANDORA" $key -}}
								{{- $label = "Pandora" -}}

							{{- else if eq "SOUNDCLOUD" $key -}}
								{{- $label = "SoundCloud" -}}
								{{- $icon = "cloud" -}}

							{{- else if eq "SPOTIFY" $key -}}
								{{- $label = "Spotify" -}}
								{{- $icon = "spotify" -}}

							{{- else if eq "TIDAL" $key -}}
								{{- $label = "Tidal" -}}

							{{- else if eq "YOUTUBE" $key -}}
								{{- $label = "YouTube Music" -}}
								{{- $icon = "youtube" -}}

							{{- else -}}
								{{- $label = domainOnly $value -}}

							{{- end -}}

							<a href="{{$value}}" class="block ellipsis" target="_blank">
								<i class="bi bi-{{$icon}}"></i> {{ $label }}
							</a>
						{{- end -}}

					{{- end -}}
					</div>
			{{- end -}}
</div>

		<div class="pos-absolute-top-right text-sm">
			{{- if $canEdit -}}
				<button hx-get="/{{.StreamID}}/edit">Edit Album</button>

				{{- if .IsPublished -}}
					<button hx-get="/{{.StreamID}}/unpublish">Un-Publish</button>
				{{- else -}}
					<button hx-get="/{{.StreamID}}/publish" class="primary">Publish</button>
				{{- end -}}

				<button hx-get="/{{.StreamID}}/add-creation"><span aria-label="Add">{{icon "add"}}</span> Image Link</button>
			{{- end -}}
			{{- if .UserCan "zip" -}}
				<a class="button" href="/{{.StreamID}}/zip">Download</a>
			{{- end -}}
		</div>


		<div hx-get="/{{.StreamID}}" hx-trigger="refreshPage from:window"></div>

	</div>

	<div hx-get="/{{.StreamID}}" hx-trigger="refreshPage from:window" hx-push-url="false"></div>


	<div class="pos-absolute-bottom-left text-sm">
		<button hx-get="/{{.StreamID}}/intent?intent=create&content={{.Label}} {{.Permalink}}"><span aria-hidden="true" class="margin-left-xs">{{icon "share"}}</span> Share</button>
		<button hx-get="/{{.StreamID}}/intent?intent=like&object={{.Permalink}}"><span aria-hidden="true" class="margin-left-xs">{{icon "thumbs-up"}}</span> Like</button>
		<button hx-get="/{{.StreamID}}/intent" aria-label="Manage Accounts">{{icon "more-horizontal"}}</button>
	</div>
</div>
</div>
