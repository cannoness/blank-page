{
	templateId: blankpage-creation
	templateRole: creation
	model: Stream
	label: Creation
	extends: ["base-intent", "blankpage-common"]
	containedBy: ["exhibit"]

	states: {
		published: {
			label: Published
			description: "This item has been published and is visible on the website"
		}
	}

	schema: {
		type: object
		properties: {
			label: {type: "string"}
			iconUrl: {type:"string", format:"url"}
			data: {
				type: object
				properties: {
					tags: {type:"string"}
					category: {type: "string"}
					genre: {type: "string"}
					hubber: {type: "string"}
					license: {type: "string"}
					title: {type: "string"}
					summary: {type: "string"}
					imageUrl: {type: "string", format:"url"}
					dateCreated: {type: "string"}
					featured: {type: "boolean"}
					mature: {type: "boolean"}
					favorites: {type: "string"}
					attachmentId: {type: "string", format:"url"}
					thumbFilename: {type: "string"}
					attachmentFilename: {type: "string"}
					links: {
						type: object
						wildcard:{type: "string", format:"url"}
					}
				}
			}
		}
	}

	socialRole: Artwork
	socialRules: [
		{target:"type", value:"Artwork"}
		{target:"attributedTo.id", path:"attributedTo.profileUrl"}
		{target:"attributedTo.name", path:"attributedTo.name"}
		{target:"links", forEach:"data.links", rules:[
			{target:"label", path:"key"}
			{target:"rel", value:"alternate"}
			{target:"href", path:"value"}
		]}
		{target:"work.type", value:"work"}
		{target:"work.id", path:"url"}
		{target:"work.name", path:"label"}
		{target:"work.exhibit", expression:"{{.ParentURL}}"}
		{target:"work.position", path:"rank"}
		{target:"content", path:"data.summary"}
		{target:"exhibit", expression:"{{.ParentURL}}"}
		{target:"library", expression:"{{.ParentURL}}/pub/children"}
	],

	search: {
		type: Artwork
		thumbUrl:"{{first .IconURL (join `/` .ParentID.Hex `/icon`)}}"
		summary:""
		text: "{{.Label}} {{.AttributedTo.Name}} {{index .Data `summary`}}"
		tags: "LIC:{{index .Data `license`}}"
	}

	tagPaths: ["data.tags"]

	actions: {
		create: {
			roles: ["author"]
			steps: [
				{do:"as-modal", steps:[
					{do: "view-html", file: "upload"}
					{
							do:"edit",
							options: ["delete:/{{.StreamID}}/delete"],
							form:{
								type: layout-tabs
								label: "Edit Creation"
								children: [
									{
										type: layout-vertical
										label: General
										children: [
											{type: "text",   path: "label", label: "Creation Title"}
											{type: "upload", path: "data.attachmentId", label: "Artwork File", options:{filename:"data.attachmentFilename", accept:"image/*",  rules:{types:["webp", "jpg", "jpeg", "png", "gif"]}}}
											{type: "upload", path: "iconUrl", label:"Preview Thumbnail", options:{accept:"image/*", filename:"data.imageFilename", delete:"/{{.StreamID}}/delete-icon", rules:{width:200, height:200, types:["webp", "jpg", "jpeg", "png", "gif"]}}}
											{type: "toggle", path: "isFeatured", options:{true-text:"Featured. Highlighted on work list", false-text:"Featured?"}}
										]
									}
									{
										type: layout-vertical
										label: Description
										children: [
											{type: "textarea", path: "data.summary", description:"Enter summary or creation description.  Displays on this creation's detail page.", options:{rows: 16}}
											{type: "toggle", path: "data.mature", options:{true-text:"Mature Content", false-text:"Mature Content"}}
										]
									}
									{
										type: layout-vertical
										label: Metadata
										children: [
											{type: "select", path: "data.license", label: "License", options:{provider:"blankpage-exhibit.licenses"}}
											{type: "select", path: "data.category", label: "Category", options:{provider:"blankpage-exhibit.categories"}}
											{type: "text", path: "data.tags", label: "Tags", description:"Enter #Hashtags separated by spaces."}
											{type: "text", path: "data.tags", label: "Tags", description:"Enter #Tags separated by spaces."}
										]
									}
									{
										type: layout-vertical
										label: Links
										children: [
											{type:"text", path:"data.links.DEVIANTART", options:{placeholder:"DeviantArt"}}
											{type:"text", path:"data.links.PIXELFED", options:{placeholder:"PixelFed"}}
											{type:"text", path:"data.links.TUMBLR", options:{placeholder:"Tumblr"}}
											{type:"text", path:"data.links.YOUTUBE", options:{placeholder:"YouTube"}}
											{type:"text", path:"data.links.OTHER1", options:{placeholder:"Other"}}
											{type:"text", path:"data.links.OTHER2", options:{placeholder:"Other"}}
											{type:"text", path:"data.links.OTHER3", options:{placeholder:"Other"}}
										]
									}
								]
							}
						}

				]}
				{do:"upload-attachments", category:"Artwork", fieldname:"data.attachmentId", download-path:"data.attachmentId", accept-type:"image/*", maximum:1, rules:{types:["webp", "jpg", "jpeg", "png", "gif"]}}
				{do:"upload-attachments", action: "replace", category:"image", fieldname:"iconUrl", download-path:"iconUrl", accept-type:"image/*", maximum:1, rules:{width:200, height:200}, rules:{types:["webp", "jpeg", "png", "jpg", "gif"]}}
   				{do:"process-tags", paths:"data.tags"}
				{do:"save-and-publish", outbox:false}
				{do:"search-index"}
				{do:"refresh-page"}
			]
		}
		view: {
			roles: ["anonymous"]
			steps: [
				{do:"view-html"}
			]
		}

		upload: {
			roles: ["author"],
			steps: [
				{do: "view-html"}
			]
		}

		edit: {
			roles: ["author"]
			steps: [
				{
					do:"as-modal"
					steps:[
						{
							do:"edit",
							options: ["delete:/{{.StreamID}}/delete"],
							form:{
								type: layout-tabs
								label: "Edit Creation"
								children: [
									{
										type: layout-vertical
										label: General
										children: [
											{type: "text",   path: "label", label: "Creation Title"}
											{type: "upload", path: "data.attachmentId", label: "Artwork File", options:{filename:"data.attachmentFilename", accept:"image/*",  rules:{types:["webp", "jpg", "jpeg", "png", "gif"]}}}
											{type: "upload", path: "iconUrl", label:"Preview Thumbnail", options:{accept:"image/*", filename:"data.imageFilename", delete:"/{{.StreamID}}/delete-icon", rules:{width:200, height:200, types:["webp", "jpg", "jpeg", "png", "gif"]}}}
											{type: "toggle", path: "isFeatured", options:{true-text:"Featured. Highlighted on work list", false-text:"Featured?"}}
										]
									}
									{
										type: layout-vertical
										label: Description
										children: [
											{type: "textarea", path: "data.summary", description:"Enter summary or creation description.  Displays on this creation's detail page.", options:{rows: 16}}
											{type: "toggle", path: "data.mature", options:{true-text:"Mature Content", false-text:"Mature Content"}}
										]
									}
									{
										type: layout-vertical
										label: Metadata
										children: [
											{type: "select", path: "data.license", label: "License", options:{provider:"blankpage-exhibit.licenses"}}
											{type: "select", path: "data.category", label: "Category", options:{provider:"blankpage-exhibit.categories"}}
											{type: "text", path: "data.tags", label: "Tags", description:"Enter #Hashtags separated by spaces."}
											{type: "text", path: "data.tags", label: "Tags", description:"Enter #Tags separated by spaces."}
										]
									}
									{
										type: layout-vertical
										label: Links
										children: [
											{type:"text", path:"data.links.DEVIANTART", options:{placeholder:"DeviantArt"}}
											{type:"text", path:"data.links.PIXELFED", options:{placeholder:"PixelFed"}}
											{type:"text", path:"data.links.TUMBLR", options:{placeholder:"Tumblr"}}
											{type:"text", path:"data.links.YOUTUBE", options:{placeholder:"YouTube"}}
											{type:"text", path:"data.links.OTHER1", options:{placeholder:"Other"}}
											{type:"text", path:"data.links.OTHER2", options:{placeholder:"Other"}}
											{type:"text", path:"data.links.OTHER3", options:{placeholder:"Other"}}
										]
									}
								]
							}
						}
					]
				}
				{do:"upload-attachments", action: "replace", category:"image", fieldname:"iconUrl", download-path:"iconUrl", accept-type:"image/*", maximum:1,  rules:{types:["webp", "jpg", "jpeg", "png", "gif"]}}
				{do:"upload-attachments", action: "replace", category:"Artwork", fieldname:"data.attachmentId", download-path:"data.attachmentId", accept-type:"image/*", maximum:1, rules:{types:["webp", "jpg", "jpeg", "png", "gif"]}}
				{do:"process-tags", paths:"data.tags"}
				{do:"if", condition: "{{.IsPublished}}",
					then: [
						{do:"save-and-publish"}
						{do:"search-index"}
					],
					else: [
						{do:"save"}
					]
				}
				{do:"refresh-page"}
			]
		}

		stylesheet: {
			roles:["anonymous"]
			steps: [
				{do:"cache-url"}
				{do:"view-css"}
			]
		}

		delete: {
			roles: ["author"],
			steps: [
				{do:"delete", title:"Delete this Creation?"}
				{do:"redirect-to", url:"/{{.StreamID}}"}
			]
		}

		delete-icon: {
			roles: ["author"],
			steps: [
				{do: "delete-attachments"}
				{do: "delete-attachments", fieldname:"iconUrl"}
				{do: "set-data", values:{"iconUrl": ""}}
				{do: "save"}
			]
		}
		prev: {
			roles: ["anonymous"],
			steps:[
				{do:"with-prev-sibling", steps:[
					{do:"redirect-to", url:"/{{.StreamID}}"}
				]}
			]
		}

		next: {
			roles: ["anonymous"],
			steps:[
				{do:"with-next-sibling", steps:[
					{do:"redirect-to", url:"/{{.StreamID}}"}
				]}
			]
		}

		image: {
			steps:[
				{do:"view-attachment", category:"image", format:["webp", "jpeg", "jpg", "png", "gif"], width:200, height:200}
			]
		}

		icon: {
			roles:["anonymous"]
			steps: [
				{do:"redirect-to", url:"{{.IconURL}}"}
			]
		}

		artwork: {
			steps:[
				{do:"view-attachment", category:"Artwork", format:["webp", "jpeg", "gif", "jpg", "png"]}
			]
		}
	}
}